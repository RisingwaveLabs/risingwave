statement ok
SET RW_IMPLICIT_FLUSH TO true;

# "nao" means non append only
# "npk" means no primary key

statement ok
create table t_nao_npk (k int, v1 int, v2 int);

statement ok
create table t_ao_npk (k int, v1 int, v2 int) APPEND ONLY;

statement ok
create table t_nao_pk (k int, v1 int, v2 int, primary key(k));

statement ok
create table t_ao_source (k int, v1 int, v2 int) APPEND ONLY;

statement ok
create table t_nao_source (k int, v1 int, v2 int);

# sinks to t_nao_npk
statement ok
create sink s1_to_t_nao_npk into t_nao_npk
as select k, v1, v2 
from t_ao_source 
FORMAT PLAIN ENCODE NATIVE;

statement error Only append-only sinks can sink to a table without primary keys.
create sink s2_to_t_nao_npk into t_nao_npk
as select k, v1, v2 
from t_nao_source 
FORMAT UPSERT ENCODE NATIVE;

statement ok
create sink s2_to_t_nao_npk into t_nao_npk
as select k, v1, v2 
from t_nao_source 
FORMAT PLAIN ENCODE NATIVE(
    force_append_only='true'
);

# sinks to t_ao_npk
statement ok
create sink s1_to_t_ao_npk into t_ao_npk
as select k, v1, v2 
from t_ao_source
FORMAT PLAIN ENCODE NATIVE;

statement error Only append-only sinks can sink to a table without primary keys.
create sink s2_to_t_ao_npk into t_ao_npk
as select k, v1, v2 
from t_nao_source
FORMAT UPSERT ENCODE NATIVE;

statement ok
create sink s2_to_t_ao_npk into t_ao_npk
as select k, v1, v2 
from t_nao_source
FORMAT PLAIN ENCODE NATIVE(
    force_append_only='true'
);

# sinks to t_nao_pk
statement ok
create sink s1_to_t_nao_pk into t_nao_pk
as select k, v1, v2 
from t_ao_source
FORMAT PLAIN ENCODE NATIVE;

statement ok
create sink s2_to_t_nao_pk into t_nao_pk
as select k, v1, v2 
from t_nao_source
FORMAT UPSERT ENCODE NATIVE;

statement ok
create sink s3_to_t_nao_pk into t_nao_pk
as select k, v1, v2 
from t_nao_source
FORMAT PLAIN ENCODE NATIVE(
    force_append_only='true'
);

statement ok
drop sink s3_to_t_nao_pk;

statement ok
drop sink s2_to_t_nao_pk;

statement ok
drop sink s1_to_t_nao_pk;

statement ok
drop sink s2_to_t_ao_npk;

statement ok
drop sink s1_to_t_ao_npk;

statement ok
drop sink s2_to_t_nao_npk;

statement ok
drop sink s1_to_t_nao_npk;

statement ok
drop table t_ao_source

statement ok
drop table t_nao_npk

statement ok
drop table t_ao_npk

statement ok
drop table t_nao_source

statement ok
drop table t_nao_pk