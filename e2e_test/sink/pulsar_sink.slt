statement ok
CREATE TABLE t0 (v1 int primary key, v2 varchar);

statement ok
CREATE MATERIALIZED VIEW mv0 AS SELECT * FROM t0;

statement ok
CREATE SINK sink0 
AS select mv0.v1 as v1, mv0.v2 as v2 from mv0 
WITH (
    connector = 'pulsar',
    type = 'upsert',
    primary_key = 'v1',
    topic='persistent://public/default/sink',
    service.url='pulsar://pulsar:6650',
);

statement ok
CREATE TABLE src0 (v1 int primary key, v2 varchar)
WITH (
   connector='pulsar',
   topic='persistent://public/default/sink',
   service.url='pulsar://pulsar:6650',
   scan.startup.mode='earliest',
) FORMAT PLAIN ENCODE JSON;

statement ok
INSERT INTO pulsar VALUES (1, 'test1');

statement ok
INSERT INTO pulsar VALUES (2, 'test2');

statement ok
INSERT INTO pulsar VALUES (3, 'test3');

query IT rowsort
SELECT * FROM src0;
----
1 test1
2 test2
3 test3