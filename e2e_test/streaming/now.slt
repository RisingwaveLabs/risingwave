# In madsim test, we cannot spawn process.
skipif madsim
# In parallel test, we cannot get the DB name.
skipif parallel
# TODO: Later if we introduce a new `now()`-like function that returns the time of statement execution,
# we'll be able to directly create MV without `./risedev psql` and so that we can remove these `skipif`.
system ok
./risedev psql -c "
create materialized view mv as
select * from generate_series(
    to_timestamp($(date +%s)) - interval '10 second',
    now(),
    interval '1 second'
);
"

skipif madsim
skipif parallel
statement ok
flush;

skipif madsim
skipif parallel
query I
select count(*) >= 10 from mv;
----
t

skipif madsim
skipif parallel
sleep 2s

skipif madsim
skipif parallel
statement ok
flush;

skipif madsim
skipif parallel
query I
select count(*) >= 12 from mv;
----
t

skipif madsim
skipif parallel
statement ok
drop materialized view mv;
