statement ok
SET RW_IMPLICIT_FLUSH TO true;

# ----

include ./to_agg_then_join.slt.part

# ----

include ./create.slt.part

statement ok
insert into t values
  (100001, 100, 200, 1, 701, 805)
, (100002, 100, 200, 2, 700, 806)
, (100003, 100, 208, 2, 723, 807)
, (100004, 103, 200, 2, 702, 808);

query iiiiii
select * from mv_a order by id;
----
100001  100  200  1  701  805  701
100002  100  200  2  700  806  701
100003  100  208  2  723  807  723
100004  103  200  2  702  808  702

query iiiiiiii
select * from mv_b order by id;
----
100001  100  200  1  701  805  2124   701  700
100002  100  200  2  700  806  2124  1401  700
100003  100  208  2  723  807  2124   723  723
100004  103  200  2  702  808   702   702  702

query iiiiiiiiii
select * from mv_c order by id;
----
100001  100  200  1  701  805  701  NULL  NULL   806  NULL
100002  100  200  2  700  806  700   701   701  NULL  NULL
100003  100  208  2  723  807  723  NULL  NULL  NULL  NULL
100004  103  200  2  702  808  702  NULL  NULL  NULL  NULL

include ./cross_check.slt.part

statement ok
insert into t values
  (100005, 100, 200, 3, 717, 810)
, (100006, 105, 204, 5, 703, 828);

query iiiiii
select * from mv_a order by id;
----
100001  100  200  1  701  805  701
100002  100  200  2  700  806  701
100003  100  208  2  723  807  723
100004  103  200  2  702  808  702
100005  100  200  3  717  810  701
100006  105  204  5  703  828  703

query iiiiiiii
select * from mv_b order by id;
----
100001  100  200  1  701  805  2841   701  700
100002  100  200  2  700  806  2841  1401  700
100003  100  208  2  723  807  2841   723  723
100004  103  200  2  702  808   702   702  702
100005  100  200  3  717  810  2841  2118  717
100006  105  204  5  703  828   703   703  703

query iiiiiiiiii
select * from mv_c order by id;
----
100001  100  200  1  701  805  701  NULL  NULL   806  NULL
100002  100  200  2  700  806  700   701   701   810   810
100003  100  208  2  723  807  723  NULL  NULL  NULL  NULL
100004  103  200  2  702  808  702  NULL  NULL  NULL  NULL
100005  100  200  3  717  810  717   700   700  NULL  NULL
100006  105  204  5  703  828  703  NULL  NULL  NULL  NULL

include ./cross_check.slt.part

statement ok
update t set v1 = 799 where id = 100002;

query iiiiii
select * from mv_a order by id;
----
100001  100  200  1  701  805  701
100002  100  200  2  799  806  701
100003  100  208  2  723  807  723
100004  103  200  2  702  808  702
100005  100  200  3  717  810  701
100006  105  204  5  703  828  703

query iiiiiiii
select * from mv_b order by id;
----
100001  100  200  1  701  805  2940   701  701
100002  100  200  2  799  806  2940  1500  717
100003  100  208  2  723  807  2940   723  723
100004  103  200  2  702  808   702   702  702
100005  100  200  3  717  810  2940  2217  717
100006  105  204  5  703  828   703   703  703

query iiiiiiiiii
select * from mv_c order by id;
----
100001  100  200  1  701  805  701  NULL  NULL   806   806
100002  100  200  2  799  806  799   701   701   810  NULL
100003  100  208  2  723  807  723  NULL  NULL  NULL  NULL
100004  103  200  2  702  808  702  NULL  NULL  NULL  NULL
100005  100  200  3  717  810  717   799   799  NULL  NULL
100006  105  204  5  703  828  703  NULL  NULL  NULL  NULL

include ./cross_check.slt.part

statement ok
delete from t where time = 2;

query iiiiii
select * from mv_a order by id;
----
100001  100  200  1  701  805  701
100005  100  200  3  717  810  701
100006  105  204  5  703  828  703

query iiiiiiii
select * from mv_b order by id;
----
100001  100  200  1  701  805  1418   701  701
100005  100  200  3  717  810  1418  1418  717
100006  105  204  5  703  828   703   703  703

query iiiiiiiiii
select * from mv_c order by id;
----
100001  100  200  1  701  805  701  NULL  NULL   810  NULL
100005  100  200  3  717  810  717   701   701  NULL  NULL
100006  105  204  5  703  828  703  NULL  NULL  NULL  NULL

include ./cross_check.slt.part

include ./drop.slt.part
