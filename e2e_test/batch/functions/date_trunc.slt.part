statement ok
SET RW_IMPLICIT_FLUSH TO true;

statement ok
CREATE TABLE t (field VARCHAR);

statement ok
INSERT INTO t VALUES
    ('microseconds'),
    ('milliseconds'),
    ('second'),
    ('minute'),
    ('hour'),
    ('day'),
    ('week'),
    ('month'),
    ('quarter'),
    ('year'),
    ('decade'),
    ('century'),
    ('millennium');

query T rowsort
SELECT field, date_trunc(field, TIMESTAMP '2202-02-16 20:38:40.123456') FROM t;
----
microseconds    2202-02-16 20:38:40.123456
milliseconds    2202-02-16 20:38:40.123
second          2202-02-16 20:38:40
minute          2202-02-16 20:38:00
hour            2202-02-16 20:00:00
day             2202-02-16 00:00:00
week            2202-02-15 00:00:00
month           2202-02-01 00:00:00
quarter         2202-01-01 00:00:00
year            2202-01-01 00:00:00
decade          2200-01-01 00:00:00
century         2201-01-01 00:00:00
millennium      2001-01-01 00:00:00

# invalid field
statement error
SELECT date_trunc('s', TIMESTAMP '2202-02-16 20:38:40.123456');

# FIXME: support timezone

# query T
# SELECT date_trunc('day', TIMESTAMP WITH TIME ZONE '2001-02-16 20:38:40+00');
# ----
# 2001-02-16 00:00:00-05

# query T
# SELECT date_trunc('day', TIMESTAMP WITH TIME ZONE '2001-02-16 20:38:40+00', 'Australia/Sydney');
# ----
# 2001-02-16 08:00:00-05

statement ok
DELETE FROM t WHERE field = 'week';

# TODO: support us precision in interval
query T rowsort
SELECT field, date_trunc(field, INTERVAL '2333 year 4 months 5 days 02:47:33.123') FROM t;
----
microseconds    2333 years 4 mons 5 days 02:47:33.123
milliseconds    2333 years 4 mons 5 days 02:47:33.123
second          2333 years 4 mons 5 days 02:47:33
minute          2333 years 4 mons 5 days 02:47:00
hour            2333 years 4 mons 5 days 02:00:00
day             2333 years 4 mons 5 days 00:00:00
month           2333 years 4 mons 00:00:00
quarter         2333 years 3 mons 00:00:00
year            2333 years 00:00:00
decade          2330 years 00:00:00
century         2300 years 00:00:00
millennium      2000 years 00:00:00

# truncate 'week' is not supported for interval
statement error
SELECT date_trunc('week', INTERVAL '3 days 02:47:33');

statement ok
DROP TABLE t;
