# https://github.com/risingwavelabs/risingwave/issues/7158

statement ok
CREATE TABLE partsupp (
                          ps_partkey INTEGER,
                          ps_suppkey INTEGER,
                          ps_availqty INTEGER,
                          ps_supplycost NUMERIC,
                          ps_comment VARCHAR,
                          PRIMARY KEY (ps_partkey, ps_suppkey)
);

statement ok
CREATE TABLE orders (
                        o_orderkey BIGINT,
                        o_custkey INTEGER,
                        o_orderstatus VARCHAR,
                        o_totalprice NUMERIC,
                        o_orderdate DATE,
                        o_orderpriority VARCHAR,
                        o_clerk VARCHAR,
                        o_shippriority INTEGER,
                        o_comment VARCHAR,
                        PRIMARY KEY (o_orderkey)
);

statement ok
CREATE MATERIALIZED VIEW m5 AS SELECT 0::int AS col_0 FROM partsupp;

query I
SELECT
    1
FROM
    m5 JOIN orders ON m5.col_0 = orders.o_orderkey
GROUP BY
    m5.col_0,
    orders.o_totalprice
HAVING
    SMALLINT '27538' = m5.col_0;
----

statement ok
DROP MATERIALIZED VIEW m5;

statement ok
DROP TABLE orders;

statement ok
DROP TABLE partsupp;

# A smaller repro, cause lookup join to panic

statement ok
CREATE TABLE t1 ();

statement ok
CREATE TABLE t2 (x BIGINT);

statement ok
CREATE MATERIALIZED VIEW m AS SELECT 0::int AS y FROM t1;

query I
SELECT
    1
FROM
    m JOIN t2 ON m.y = t2.x AND m.y=1;
----

statement ok
DROP MATERIALIZED VIEW m;

statement ok
DROP TABLE t2;

statement ok
DROP TABLE t1;