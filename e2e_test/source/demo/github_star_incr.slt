statement ok
create materialized source github_star (created_at timestamp , id varchar, name varchar)
with ( 'connector' = 'kafka', 'kafka.topic' = 'github_star_incr_topic', 'kafka.brokers' = '127.0.0.1:29092', 'kafka.scan.startup.mode'='earliest' ) row format json;

statement ok
CREATE MATERIALIZED VIEW time_view as
SELECT count(name) as star_count, name, window_start
FROM tumble(github_star, created_at, interval '10' minute)
group by name,window_start;

statement ok
CREATE MATERIALIZED VIEW topK_star_incr_view as
SELECT * FROM time_view
where window_start = (select max(window_start) from time_view)
order by star_count desc limit 5;

query TTT
SELECT * from topK_star_incr_view limit 1;
----
1 9to5/pushr-core 2022-06-16 23:20:00


